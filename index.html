<!DOCTYPE html>
<html lang="fr">
<head>
    <!-- Commit: fichier mis √† jour et pouss√© le 2025-11-09 -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="theme-color" content="#667eea">
    <!-- iOS / Safari PWA meta -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="AmorFati">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <link rel="apple-touch-icon" sizes="120x120" href="/icons/icon-120.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/icons/icon-152.png">
    <link rel="apple-touch-icon" sizes="167x167" href="/icons/icon-167.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/icon-180.png">
    <meta name="mobile-web-app-capable" content="yes">
    <!-- iOS splash screens -->
    <link rel="apple-touch-startup-image" href="/icons/splash-640x1136.png" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="/icons/splash-750x1334.png" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="/icons/splash-1125x2436.png" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="/icons/splash-1242x2208.png" media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)">
    <link rel="apple-touch-startup-image" href="/icons/splash-1536x2048.png" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)">
    <meta name="description" content="√âvaluation personnelle Amor Fati - Suivi de ton √©volution philosophique">
    <link rel="manifest" href="/manifest.json">
    <title>Amor Fati Tracker - Suivi Personnel</title>
    <!-- Tailwind CDN (utilisation d'exemple rapide, non obligatoire en production) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="/styles.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üåü Amor Fati Tracker</h1>
            <p>"Ne rien vouloir d'autre que ce qui est" - Nietzsche</p>
        </div>
        
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('welcome')">Accueil</button>
            <button class="nav-tab" onclick="switchTab('assessment')">√âvaluation</button>
            <button class="nav-tab" onclick="switchTab('history')">Historique</button>
            <button class="nav-tab" onclick="switchTab('settings')">Param√®tres</button>
        </div>
        
        <!-- Welcome Tab -->
        <div id="welcome" class="tab-content active">
            <div class="onboarding">
                <h2>Bienvenue dans ton suivi Amor Fati</h2>
                <p>Cet outil te permet d'√©valuer o√π tu te situes dans ton cheminement vers l'acceptation totale de ta vie (amor fati) et de suivre ton √©volution dans le temps.</p>
                
                <div class="alert alert-info">
                    <strong>üîí 100% Confidentiel :</strong> Toutes tes donn√©es restent dans ton appareil. Rien n'est envoy√© en ligne. Tu peux m√™me l'utiliser hors connexion.
                </div>
                
                <div class="priority-selection" id="prioritySelection">
                    <h3>Avant de commencer : Quelle dimension souhaites-tu voir √©voluer en priorit√© ?</h3>
                    <p style="color: #666; font-size: 0.9em; margin-bottom: 15px;">Cette r√©flexion t'aidera √† orienter ton travail sur toi-m√™me. Tu pourras la modifier √† tout moment.</p>
                    
                    <div class="priority-options">
                        <label class="priority-option">
                            <input type="radio" name="priority" value="ressentiment">
                            <div>
                                <span class="priority-label">üî• Pass√© & Ressentiment</span>
                                <span class="priority-desc">Me lib√©rer du poids de mon pass√©, d√©passer la col√®re et l'amertume</span>
                            </div>
                        </label>
                        
                        <label class="priority-option">
                            <input type="radio" name="priority" value="souffrance">
                            <div>
                                <span class="priority-label">‚ö° Souffrance pr√©sente</span>
                                <span class="priority-desc">Mieux accepter et traverser les difficult√©s actuelles</span>
                            </div>
                        </label>
                        
                        <label class="priority-option">
                            <input type="radio" name="priority" value="authenticite">
                            <div>
                                <span class="priority-label">üé≠ Authenticit√©</span>
                                <span class="priority-desc">Vivre selon mes propres valeurs, √™tre vraiment moi-m√™me</span>
                            </div>
                        </label>
                        
                        <label class="priority-option">
                            <input type="radio" name="priority" value="creation">
                            <div>
                                <span class="priority-label">üé® Cr√©ation</span>
                                <span class="priority-desc">Devenir un cr√©ateur actif de ma vie plut√¥t que subir</span>
                            </div>
                        </label>
                        
                        <label class="priority-option">
                            <input type="radio" name="priority" value="eternel">
                            <div>
                                <span class="priority-label">‚ôæÔ∏è √âternel Retour</span>
                                <span class="priority-desc">Affirmer totalement ma vie, vouloir la revivre telle quelle</span>
                            </div>
                        </label>
                        
                        <label class="priority-option">
                            <input type="radio" name="priority" value="none">
                            <div>
                                <span class="priority-label">üß≠ Aucune priorit√© sp√©cifique</span>
                                <span class="priority-desc">Je veux juste observer mon √©volution globale</span>
                            </div>
                        </label>
                    </div>
                </div>
                
                <button class="btn" onclick="startAssessment()">Commencer ma premi√®re √©valuation</button>
            </div>
        </div>
        
        <!-- Assessment Tab -->
        <div id="assessment" class="tab-content">
            <form id="assessmentForm">
                <!-- Dimension 1 -->
                <div class="dimension">
                    <h2>1. Rapport au pass√© & Ressentiment</h2>
                    <p class="dimension-description">Comment te situes-tu face √† ton histoire personnelle et aux √©v√©nements difficiles que tu as v√©cus ?</p>
                    
                    <div class="question">
                        <div class="question-text">Quand tu repenses √† des √©v√©nements difficiles de ton pass√©, que ressens-tu principalement ?</div>
                        <div class="options">
                            <label class="option">
                                <input type="radio" name="q1" value="0">
                                <span class="option-label">Une col√®re vive, un sentiment d'injustice qui me consume r√©guli√®rement <span class="score-badge">0 pt</span></span>
                            </label>
                            <label class="option">
                                <input type="radio" name="q1" value="1">
                                <span class="option-label">De l'amertume, je me dis souvent "si seulement √ßa ne s'√©tait pas pass√©" <span class="score-badge">1 pt</span></span>
                            </label>
                            <label class="option">
                                <input type="radio" name="q1" value="2">
                                <span class="option-label">De la tristesse parfois, mais je n'y pense plus constamment <span class="score-badge">2 pts</span></span>
                            </label>
                            <label class="option">
                                <input type="radio" name="q1" value="3">
                                <span class="option-label">Une acceptation tranquille, c'est mon histoire et elle fait partie de moi <span class="score-badge">3 pts</span></span>
                            </label>
                            <label class="option">
                                <input type="radio" name="q1" value="4">
                                <span class="option-label">Une affirmation compl√®te : je ne voudrais pas que √ßa n'ait pas exist√© <span class="score-badge">4 pts</span></span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="question">
                        <div class="question-text">Face aux personnes qui t'ont fait du mal dans le pass√©, quelle est ton attitude ?</div>
                        <div class="options">
                            <label class="option">
                                <input type="radio" name="q2" value="0">
                                <span class="option-label">Je leur en veux profond√©ment, j'imagine parfois me venger <span class="score-badge">0 pt</span></span>
                            </label>
                            <label class="option">
                                <input type="radio" name="q2" value="1">
                                <span class="option-label">Je leur en veux encore beaucoup, j'√©vite d'y penser car √ßa me met en col√®re <span class="score-badge">1 pt</span></span>
                            </label>
                            <label class="option">
                                <input type="radio" name="q2" value="2">
                                <span class="option-label">Je travaille √† leur pardonner, mais c'est difficile <span class="score-badge">2 pts</span></span>
                            </label>
                            <label class="option">
                                <input type="radio" name="q2" value="3">
                                <span class="option-label">Je ne leur en veux plus vraiment, j'ai tourn√© la page <span class="score-badge">3 pts</span></span>
                            </label>
                            <label class="option">
                                <input type="radio" name="q2" value="4">
                                <span class="option-label">Je les accepte comme faisant partie de mon histoire, sans ressentiment ni besoin de pardon <span class="score-badge">4 pts</span></span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Dimension 2 -->
                <div class="dimension">
                    <h2>2. Attitude face √† la souffrance pr√©sente</h2>
                    <p class="dimension-description">Comment r√©agis-tu face aux difficult√©s et souffrances actuelles de ta vie ?</p>
                    
                    <div class="question">
                        <div class="question-text">Quand tu traverses une √©preuve difficile (maladie, √©chec, perte), quelle est ta r√©action dominante ?</div>
                        <div class="options">
                            <label class="option">
                                <input type="radio" name="q3" value="0">
                                <span class="option-label">"Pourquoi moi ? C'est injuste !" - Je me sens victime <span class="score-badge">0 pt</span></span>
                            </label>
                            <label class="option">
                                <input type="radio" name="q3" value="1">
                                <span class="option-label">"Il faut que je transforme √ßa en quelque chose de positif pour que √ßa ait un sens" <span class="score-badge">1 pt</span></span>
                            </label>
                            <label class="option">
                                <input type="radio" name="q3" value="2">
                                <span class="option-label">"C'est dur, mais √ßa fait partie de la vie, je vais m'en sortir" <span class="score-badge">2 pts</span></span>
                            </label>
                            <label class="option">
                                <input type="radio" name="q3" value="3">
                                <span class="option-label">"C'est une √©preuve, je l'accepte et je vais la traverser avec dignit√©" <span class="score-badge">3 pts</span></span>
                            </label>
                            <label class="option">
                                <input type="radio" name="q3" value="4">
                                <span class="option-label">"Cette souffrance fait partie de ma vie, je dis oui m√™me √† cela" <span class="score-badge">4 pts</span></span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="question">
                        <div class="question-text">Comment r√©agis-tu quand quelque chose √©chappe compl√®tement √† ton contr√¥le ?</div>
                        <div class="options">
                            <label class="option">
                                <input type="radio" name="q4" value="0">
                                <span class="option-label">Je m'√©nerve, je lutte contre la r√©alit√©, je refuse d'accepter <span class="score-badge">0 pt</span></span>
                            </label>
                            <label class="option">
                                <input type="radio" name="q4" value="1">
                                <span class="option-label">Je suis frustr√© mais je finis par me r√©signer √† contrec≈ìur <span class="score-badge">1 pt</span></span>
                            </label>
                            <label class="option">
                                <input type="radio" name="q4" value="2">
                                <span class="option-label">J'accepte relativement vite et je me concentre sur ce que je peux contr√¥ler <span class="score-badge">2 pts</span></span>
                            </label>
                            <label class="option">
                                <input type="radio" name="q4" value="3">
                                <span class="option-label">J'accepte sereinement, je comprends que tout ne d√©pend pas de moi <span class="score-badge">3 pts</span></span>
                            </label>
                            <label class="option">
                                <input type="radio" name="q4" value="4">
                                <span class="option-label">J'accueille m√™me cela comme faisant partie du flux de la vie <span class="score-badge">4 pts</span></span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Dimension 3 -->
                <div class="dimension">
                    <h2>3. Rapport √† soi-m√™me & Authenticit√©</h2>
                    <p class="dimension-description">Dans quelle mesure vis-tu selon tes propres valeurs plut√¥t que selon les attentes ext√©rieures ?</p>
                    
                    <div class="question">
                        <div class="question-text">Concernant tes choix de vie importants (travail, relations, projets), tu dirais qu'ils sont :</div>
                        <div class="options">
                            <label class="option">
                                <input type="radio" name="q5" value="0">
                                <span class="option-label">Principalement dict√©s par les attentes des autres (famille, soci√©t√©) <span class="score-badge">0 pt</span></span>
                            </label>
                            <label class="option">
                                <input type="radio" name="q5" value="1">
                                <span class="option-label">Un m√©lange, mais j'ai du mal √† distinguer ce qui vient vraiment de moi <span class="score-badge">1 pt</span></span>
                            </label>
                            <label class="option">
                                <input type="radio" name="q5" value="2">
                                <span class="option-label">Plut√¥t align√©s avec mes valeurs, m√™me si je fais parfois des compromis <span class="score-badge">2 pts</span></span>
                            </label>
                            <label class="option">
                                <input type="radio" name="q5" value="3">
                                <span class="option-label">Clairement align√©s avec mes valeurs personnelles, j'assume mes choix <span class="score-badge">3 pts</span></span>
                            </label>
                            <label class="option">
                                <input type="radio" name="q5" value="4">
                                <span class="option-label">Je cr√©e mes propres valeurs et vis selon elles, ind√©pendamment du jugement <span class="score-badge">4 pts</span></span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="question">
                        <div class="question-text">Si tu devais √™tre totalement honn√™te : acceptes-tu qui tu es vraiment (forces ET faiblesses) ?</div>
                        <div class="options">
                            <label class="option">
                                <input type="radio" name="q6" value="0">
                                <span class="option-label">Non, je me d√©teste ou je rejette des parties de moi-m√™me <span class="score-badge">0 pt</span></span>
                            </label>
                            <label class="option">
                                <input type="radio" name="q6" value="1">
                                <span class="option-label">J'accepte mes forces mais je suis en lutte contre mes faiblesses <span class="score-badge">1 pt</span></span>
                            </label>
                            <label class="option">
                                <input type="radio" name="q6" value="2">
                                <span class="option-label">J'apprends √† m'accepter, c'est un travail en cours <span class="score-badge">2 pts</span></span>
                            </label>
                            <label class="option">
                                <input type="radio" name="q6" value="3">
                                <span class="option-label">Oui, j'accepte qui je suis dans ma globalit√© <span class="score-badge">3 pts</span></span>
                            </label>
                            <label class="option">
                                <input type="radio" name="q6" value="4">
                                <span class="option-label">J'affirme totalement qui je suis, y compris mes parts d'ombre <span class="score-badge">4 pts</span></span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Dimension 4 -->
                <div class="dimension">
                    <h2>4. Cr√©ation vs R√©action</h2>
                    <p class="dimension-description">Es-tu un cr√©ateur actif de ta vie ou r√©agis-tu principalement aux circonstances ?</p>
                    
                    <div class="question">
                        <div class="question-text">Dans ta vie quotidienne, tu dirais que tu passes le plus de temps √† :</div>
                        <div class="options">
                            <label class="option">
                                <input type="radio" name="q7" value="0">
                                <span class="option-label">Subir et me plaindre de ce qui m'arrive <span class="score-badge">0 pt</span></span>
                            </label>
                            <label class="option">
                                <input type="radio" name="q7" value="1">
                                <span class="option-label">Consommer (divertissements, r√©seaux sociaux, s√©ries...) <span class="score-badge">1 pt</span></span>
                            </label>
                            <label class="option">
                                <input type="radio" name="q7" value="2">
                                <span class="option-label">G√©rer mes obligations avec un peu de temps pour moi <span class="score-badge">2 pts</span></span>
                            </label>
                            <label class="option">
                                <input type="radio" name="q7" value="3">
                                <span class="option-label">Construire activement des projets qui me tiennent √† c≈ìur <span class="score-badge">3 pts</span></span>
                            </label>
                            <label class="option">
                                <input type="radio" name="q7" value="4">
                                <span class="option-label">Cr√©er (art, pens√©e, relations, ≈ìuvres) avec passion et n√©cessit√© <span class="score-badge">4 pts</span></span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="question">
                        <div class="question-text">Face √† un √©chec ou une difficult√©, tu as tendance √† :</div>
                        <div class="options">
                            <label class="option">
                                <input type="radio" name="q8" value="0">
                                <span class="option-label">T'effondrer et abandonner, rester paralys√© <span class="score-badge">0 pt</span></span>
                            </label>
                            <label class="option">
                                <input type="radio" name="q8" value="1">
                                <span class="option-label">Chercher qui bl√¢mer (les autres, les circonstances, toi-m√™me) <span class="score-badge">1 pt</span></span>
                            </label>
                            <label class="option">
                                <input type="radio" name="q8" value="2">
                                <span class="option-label">Prendre du recul, apprendre et r√©essayer <span class="score-badge">2 pts</span></span>
                            </label>
                            <label class="option">
                                <input type="radio" name="q8" value="3">
                                <span class="option-label">Utiliser l'√©chec comme mat√©riau pour cr√©er quelque chose de nouveau <span class="score-badge">3 pts</span></span>
                            </label>
                            <label class="option">
                                <input type="radio" name="q8" value="4">
                                <span class="option-label">L'accepter totalement et cr√©er √† partir de cette nouvelle r√©alit√© <span class="score-badge">4 pts</span></span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Dimension 5 -->
                <div class="dimension">
                    <h2>5. Le test de l'√âternel Retour</h2>
                    <p class="dimension-description">La question ultime de Nietzsche : voudrais-tu revivre ta vie exactement comme elle a √©t√© ?</p>
                    
                    <div class="question">
                        <div class="question-text">Si tu devais revivre ta vie EXACTEMENT √† l'identique (m√™me joies, m√™me souffrances, m√™me erreurs), que r√©pondrais-tu ?</div>
                        <div class="options">
                            <label class="option">
                                <input type="radio" name="q9" value="0">
                                <span class="option-label">Non, surtout pas ! Ma vie a trop de souffrance et d'√©checs <span class="score-badge">0 pt</span></span>
                            </label>
                            <label class="option">
                                <input type="radio" name="q9" value="1">
                                <span class="option-label">Non, je voudrais changer beaucoup de choses <span class="score-badge">1 pt</span></span>
                            </label>
                            <label class="option">
                                <input type="radio" name="q9" value="2">
                                <span class="option-label">Peut-√™tre... si je pouvais changer quelques √©v√©nements cl√©s <span class="score-badge">2 pts</span></span>
                            </label>
                            <label class="option">
                                <input type="radio" name="q9" value="3">
                                <span class="option-label">Probablement oui, m√™me si certains moments ont √©t√© tr√®s durs <span class="score-badge">3 pts</span></span>
                            </label>
                            <label class="option">
                                <input type="radio" name="q9" value="4">
                                <span class="option-label">Oui, absolument, sans changer une seule chose <span class="score-badge">4 pts</span></span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="question">
                        <div class="question-text">Honn√™tement, pourquoi accepterais-tu (ou pas) de revivre ta vie ?</div>
                        <div class="options">
                            <label class="option">
                                <input type="radio" name="q10" value="0">
                                <span class="option-label">Je ne l'accepterais pas, il y a eu trop de souffrance inutile <span class="score-badge">0 pt</span></span>
                            </label>
                            <label class="option">
                                <input type="radio" name="q10" value="1">
                                <span class="option-label">Seulement si la souffrance m'a "servi" √† quelque chose <span class="score-badge">1 pt</span></span>
                            </label>
                            <label class="option">
                                <input type="radio" name="q10" value="2">
                                <span class="option-label">Parce que les bons moments compensent les mauvais <span class="score-badge">2 pts</span></span>
                            </label>
                            <label class="option">
                                <input type="radio" name="q10" value="3">
                                <span class="option-label">Parce que c'est ma vie, avec tout ce qu'elle comporte <span class="score-badge">3 pts</span></span>
                            </label>
                            <label class="option">
                                <input type="radio" name="q10" value="4">
                                <span class="option-label">Parce que j'affirme la totalit√© de l'existence, m√™me le tragique <span class="score-badge">4 pts</span></span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Context Note -->
                <div class="context-note">
                    <label for="contextNote">üìù Note de contexte (optionnel)</label>
                    <textarea id="contextNote" placeholder="Que se passe-t-il dans ta vie en ce moment ? (ex: semaine difficile au travail, p√©riode de calme, √©v√©nement marquant...)"></textarea>
                </div>

                <button type="button" class="btn" onclick="calculateResults()">üìä Calculer mon score</button>
            </form>

            <div id="results" class="results"></div>
        </div>
        
        <!-- History Tab -->
        <div id="history" class="tab-content">
            <div id="historyContent"></div>
        </div>
        
        <!-- Settings Tab -->
        <div id="settings" class="tab-content">
            <div class="setting-item">
                <h3>üéØ Ta priorit√© actuelle</h3>
                <p id="currentPriority"></p>
                <button class="btn btn-secondary" onclick="changePriority()">Modifier ma priorit√©</button>
            </div>
            
            <div class="setting-item">
                <h3>üìä Exporter mes donn√©es</h3>
                <p>T√©l√©charge toutes tes √©valuations en format JSON pour les sauvegarder ou les transf√©rer sur un autre appareil.</p>
                <button class="btn btn-secondary" onclick="exportData()">T√©l√©charger mes donn√©es</button>
            </div>
            
            <div class="setting-item">
                <h3>üì• Importer des donn√©es</h3>
                <p>Restaure tes √©valuations depuis un fichier de sauvegarde.</p>
                <input type="file" id="importFile" accept=".json" style="display:none" onchange="importData(event)">
                <button class="btn btn-secondary" onclick="document.getElementById('importFile').click()">Importer un fichier</button>
            </div>
            
            <div class="alert alert-info">
                <strong>üí° Conseil :</strong> Il est recommand√© de faire une √©valuation une fois par semaine, toujours le m√™me jour (ex: dimanche soir) pour une meilleure comparabilit√©.
            </div>
            
            <div class="setting-item">
                <h3>üóëÔ∏è Supprimer toutes mes donn√©es</h3>
                <p style="color: #dc3545;"><strong>‚ö†Ô∏è Attention :</strong> Cette action est irr√©versible. Toutes tes √©valuations seront d√©finitivement supprim√©es.</p>
                <button class="btn btn-danger" onclick="deleteAllData()">Tout supprimer</button>
            </div>
        </div>
    </div>

    <!-- Install Prompt -->
    <div id="installPrompt" class="install-prompt">
        <h3 style="margin-bottom: 10px;">üì± Installer l'application</h3>
        <p style="font-size: 0.9em; color: #666;">Installe Amor Fati Tracker sur ton appareil pour y acc√©der rapidement et l'utiliser hors ligne.</p>
        <div class="install-buttons">
            <button onclick="installApp()" style="background: var(--primary); color: white;">Installer</button>
            <button onclick="dismissInstall()" style="background: #6c757d; color: white;">Plus tard</button>
        </div>
    </div>

    <!-- Update available banner -->
    <div id="updateBanner" style="display:none; position:fixed;bottom:20px;left:20px;right:20px;z-index:1100;">
        <div style="background:#fff; padding:12px; border-radius:8px; box-shadow:0 8px 30px rgba(0,0,0,0.15); display:flex; gap:10px; align-items:center; justify-content:space-between;">
            <div style="display:flex; gap:10px; align-items:center;">
                <div style="width:36px; height:36px; border-radius:8px; background:linear-gradient(90deg,#667eea,#764ba2); display:flex; align-items:center; justify-content:center; color:white; font-weight:bold;">‚Üª</div>
                <div>
                    <div style="font-weight:700; color:#333">Nouvelle version disponible</div>
                    <div style="font-size:0.9em; color:#666">Recharge pour appliquer la mise √† jour</div>
                </div>
            </div>
    
                    <!-- Add-to-Home modal (first visit) -->
                    <div id="addModal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.4); z-index:1200; align-items:center; justify-content:center;">
                        <div style="background:white; padding:18px; border-radius:12px; width:90%; max-width:420px; box-shadow:0 12px 40px rgba(0,0,0,0.2);">
                            <h3 style="margin:0 0 8px; color:var(--primary);">Ajouter Amor Fati √† l'√©cran d'accueil</h3>
                            <p style="color:#555; margin-bottom:12px;">Pour un acc√®s rapide et une exp√©rience hors-ligne, tu peux ajouter l'application √† l'√©cran d'accueil de ton t√©l√©phone.</p>
                            <div style="display:flex; gap:8px; justify-content:flex-end;">
                                <button id="addModalDismiss" class="btn btn-secondary">Plus tard</button>
                                <button id="addModalAction" class="btn">Installer</button>
                            </div>
                        </div>
                    </div>
            <div style="display:flex; gap:8px;">
                <button id="updateReload" class="btn">Recharger</button>
                <button id="updateDismiss" class="btn btn-secondary">Plus tard</button>
            </div>
        </div>
    </div>

    <script>
        // Variables globales
        let deferredPrompt;
        const STORAGE_KEY = 'amorFatiData';
        
        // Donn√©es de l'application
        let appData = {
            priority: null,
            assessments: [],
            settings: {
                lastAssessment: null
            }
        };
        
        // Charger les donn√©es au d√©marrage
        loadData();
        
        // Gestion de l'installation PWA
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            document.getElementById('installPrompt').classList.add('show');
        });
        
        function installApp() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    deferredPrompt = null;
                    dismissInstall();
                });
            }
        }
        
        function dismissInstall() {
            document.getElementById('installPrompt').classList.remove('show');
        }
        
        // Gestion des onglets
        function switchTab(tabName) {
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
            
            if (tabName === 'history') {
                displayHistory();
            } else if (tabName === 'settings') {
                displaySettings();
            }
        }
        
        // Gestion de la s√©lection des options
        document.querySelectorAll('.option').forEach(option => {
            option.addEventListener('click', function() {
                const radio = this.querySelector('input[type="radio"]');
                const name = radio.name;
                
                document.querySelectorAll(`input[name="${name}"]`).forEach(r => {
                    r.parentElement.classList.remove('selected');
                });
                
                radio.checked = true;
                this.classList.add('selected');
            });
        });
        
        // Gestion des priorit√©s
        document.querySelectorAll('.priority-option').forEach(option => {
            option.addEventListener('click', function() {
                const radio = this.querySelector('input[type="radio"]');
                document.querySelectorAll('.priority-option').forEach(opt => {
                    opt.classList.remove('selected');
                });
                radio.checked = true;
                this.classList.add('selected');
            });
        });
        
        // D√©marrer l'√©valuation
        function startAssessment() {
            const selectedPriority = document.querySelector('input[name="priority"]:checked');
            if (!selectedPriority) {
                alert('Merci de s√©lectionner une priorit√© avant de commencer.');
                return;
            }
            
            appData.priority = selectedPriority.value;
            saveData();
            switchTab('assessment');
            document.querySelector('.nav-tab:nth-child(2)').click();
        }
        
        // Calculer les r√©sultats
        function calculateResults() {
            const form = document.getElementById('assessmentForm');
            const formData = new FormData(form);
            
            // V√©rifier que toutes les questions sont r√©pondues
            const totalQuestions = 10;
            let answeredQuestions = 0;
            for (let i = 1; i <= totalQuestions; i++) {
                if (formData.get(`q${i}`)) {
                    answeredQuestions++;
                }
            }
            
            if (answeredQuestions < totalQuestions) {
                alert(`Merci de r√©pondre √† toutes les questions (${answeredQuestions}/${totalQuestions} r√©pondues)`);
                return;
            }
            
            // Calculer les scores par dimension
            const dimensions = {
                'Pass√© & Ressentiment': [1, 2],
                'Souffrance pr√©sente': [3, 4],
                'Authenticit√©': [5, 6],
                'Cr√©ation': [7, 8],
                '√âternel Retour': [9, 10]
            };
            
            let totalScore = 0;
            let dimensionScores = {};
            let answers = {};
            
            for (const [dimension, questions] of Object.entries(dimensions)) {
                let dimScore = 0;
                questions.forEach(q => {
                    const score = parseInt(formData.get(`q${q}`));
                    dimScore += score;
                    answers[`q${q}`] = score;
                });
                dimensionScores[dimension] = dimScore;
                totalScore += dimScore;
            }
            
            // Sauvegarder l'√©valuation
            const assessment = {
                date: new Date().toISOString(),
                totalScore: totalScore,
                dimensionScores: dimensionScores,
                answers: answers,
                context: document.getElementById('contextNote').value,
                priority: appData.priority
            };
            
            appData.assessments.push(assessment);
            appData.settings.lastAssessment = assessment.date;
            saveData();
            
            // Afficher les r√©sultats
            displayResults(assessment);
            
            // Scroller vers les r√©sultats
            document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
        }
        
        // Afficher les r√©sultats
        function displayResults(assessment) {
            const resultsDiv = document.getElementById('results');
            const interpretation = getInterpretation(assessment.totalScore);
            const recommendations = getRecommendations(assessment.dimensionScores, appData.priority);
            
            let html = `
                <div class="total-score">Score total : ${assessment.totalScore}/40</div>
                
                <div class="interpretation">
                    <h3>${interpretation.title}</h3>
                    ${interpretation.text.map(p => `<p>${p}</p>`).join('')}
                </div>
                
                <div class="dimension-scores">
            `;
            
            for (const [dimension, score] of Object.entries(assessment.dimensionScores)) {
                const percentage = (score / 8) * 100;
                html += `
                    <div class="dimension-score">
                        <h4>${dimension}</h4>
                        <div class="dimension-score-value">${score}/8</div>
                        <div class="score-bar">
                            <div class="score-fill" style="width: ${percentage}%"></div>
                        </div>
                    </div>
                `;
            }
            
            html += `
                </div>
                
                ${getEvolutionComparison()}
                
                <div class="interpretation">
                    <h3>üéØ Recommandations personnalis√©es</h3>
                    ${recommendations.map(r => `<p>‚Üí ${r}</p>`).join('')}
                </div>
                
                <button class="btn" onclick="resetForm()">Nouvelle √©valuation</button>
            `;
            
            resultsDiv.innerHTML = html;
            resultsDiv.classList.add('show');
        }
        
        // Obtenir l'interpr√©tation du score
        function getInterpretation(score) {
            const interpretations = [
                {
                    min: 0, max: 8,
                    title: "üåë Nihilisme & Ressentiment (0-8 points)",
                    text: [
                        "Tu es actuellement dans une phase de forte r√©activit√© face √† ta vie. Le ressentiment et le refus de ce qui est consomment beaucoup de ton √©nergie.",
                        "C'est normal et humain. Beaucoup de gens passent par l√†. L'important est de reconna√Ætre o√π tu en es pour pouvoir avancer.",
                        "Commence par identifier une seule chose dans ta vie que tu pourrais accepter cette semaine, sans chercher √† la justifier ou √† la changer."
                    ]
                },
                {
                    min: 9, max: 16,
                    title: "üåò R√©signation & Lutte (9-16 points)",
                    text: [
                        "Tu oscilles entre acceptation forc√©e et lutte int√©rieure. Une partie de toi veut l√¢cher prise, une autre r√©siste encore.",
                        "Cette phase de transition est courageuse. Tu commences √† voir qu'il pourrait y avoir une autre fa√ßon de vivre.",
                        "Concentre-toi sur les dimensions o√π ton score est le plus bas - c'est l√† que le travail sera le plus transformateur."
                    ]
                },
                {
                    min: 17, max: 24,
                    title: "üåó Acceptation en Construction (17-24 points)",
                    text: [
                        "Tu es sur un bon chemin. Tu as d√©j√† int√©gr√© certaines formes d'acceptation, m√™me si ce n'est pas toujours facile.",
                        "L'amor fati n'est pas encore pleinement v√©cu, mais tu en comprends d√©j√† la logique et tu l'appliques par moments.",
                        "Continue ce travail. Observe dans quelles situations tu retombes dans le ressentiment, et pourquoi."
                    ]
                },
                {
                    min: 25, max: 32,
                    title: "üåñ Affirmation Avanc√©e (25-32 points)",
                    text: [
                        "Tu as atteint un niveau significatif d'amor fati. Tu acceptes une grande partie de ta vie sans chercher √† la justifier.",
                        "Il reste peut-√™tre quelques zones de r√©sistance - c'est normal. L'important est que tu cr√©√©s activement plut√¥t que de r√©agir.",
                        "Tu es probablement d√©j√† une inspiration pour d'autres, m√™me sans le savoir. Continue √† approfondir."
                    ]
                },
                {
                    min: 33, max: 40,
                    title: "üåï Amor Fati Accompli (33-40 points)",
                    text: [
                        "Tu incarnes l'amor fati √† un niveau rare. Tu affirmes ta vie totalement, m√™me dans ses aspects les plus difficiles.",
                        "Attention √† ne pas tomber dans l'orgueil ou la performance de 'l'homme fort'. Le vrai amor fati reste humble.",
                        "Ta pr√©sence m√™me peut aider les autres √† voir qu'un autre rapport √† la vie est possible. Partage ce que tu vis, sans pros√©lytisme."
                    ]
                }
            ];
            
            return interpretations.find(i => score >= i.min && score <= i.max);
        }
        
        // Obtenir des recommandations personnalis√©es
        function getRecommendations(dimensionScores, priority) {
            const recommendations = [];
            const dimensionNames = {
                'Pass√© & Ressentiment': 'ressentiment',
                'Souffrance pr√©sente': 'souffrance',
                'Authenticit√©': 'authenticite',
                'Cr√©ation': 'creation',
                '√âternel Retour': 'eternel'
            };
            
            // Identifier la dimension la plus faible
            let lowestDimension = null;
            let lowestScore = 8;
            
            for (const [dimension, score] of Object.entries(dimensionScores)) {
                if (score < lowestScore) {
                    lowestScore = score;
                    lowestDimension = dimension;
                }
            }
            
            // Recommandations bas√©es sur la priorit√© de l'utilisateur
            const priorityRecommendations = {
                'ressentiment': [
                    "√âcris une lettre (que tu n'enverras pas) √† quelqu'un qui t'a fait du mal. Puis br√ªle-la symboliquement.",
                    "Pratique l'exercice : 'Et si cette personne avait fait exactement ce qu'elle devait faire pour que je devienne qui je suis ?'",
                    "Journal : chaque soir, note un √©v√©nement pass√© douloureux et √©cris : 'Je dis oui √† cette partie de mon histoire.'"
                ],
                'souffrance': [
                    "Face √† une difficult√© cette semaine, demande-toi : 'Comment puis-je cr√©er quelque chose √† partir de cela ?'",
                    "Pratique la distinction sto√Øcienne : liste ce qui d√©pend de toi vs ce qui n'en d√©pend pas.",
                    "M√©ditation sur l'impermanence : tout passe, m√™me cette souffrance. Peux-tu l'accepter le temps qu'elle dure ?"
                ],
                'authenticite': [
                    "Identifie une d√©cision que tu prends par peur du jugement. Peux-tu faire autrement cette semaine ?",
                    "Liste 5 valeurs qui te d√©finissent vraiment. Tes choix de vie les refl√®tent-ils ?",
                    "Exercice : pendant une journ√©e, observe combien de fois tu te censures ou joues un r√¥le."
                ],
                'creation': [
                    "Remplace une heure de consommation par une heure de cr√©ation (peu importe quoi).",
                    "Face √† un probl√®me, demande-toi : 'Que puis-je cr√©er √† partir de cette contrainte ?'",
                    "Lance un micro-projet cr√©atif cette semaine, sans attendre qu'il soit parfait."
                ],
                'eternel': [
                    "Pratique l'exercice de l'√©ternel retour : visualise ta vie qui se r√©p√®te. Qu'est-ce qui te fait dire non ? Pourquoi ?",
                    "Liste 3 aspects de ta vie que tu voudrais revivre √©ternellement. Puis 3 que tu refuserais. Explore le pourquoi.",
                    "Chaque soir : 'Voudrais-je revivre cette journ√©e √©ternellement ?' Si non, qu'est-ce qui devrait changer ?"
                ],
                'none': [
                    "Observe simplement ton √©volution sans te juger. Le chemin est aussi important que la destination.",
                    "Concentre-toi sur ta dimension la plus faible (voir ci-dessus)."
                ]
            };
            
            // Ajouter les recommandations li√©es √† la priorit√©
            if (priority && priorityRecommendations[priority]) {
                recommendations.push(...priorityRecommendations[priority]);
            }
            
            // Ajouter une recommandation pour la dimension la plus faible
            if (lowestDimension && lowestScore < 4) {
                recommendations.push(`<strong>Focus sur "${lowestDimension}"</strong> : C'est ta dimension la plus faible (${lowestScore}/8). C'est l√† que le travail aura le plus d'impact.`);
            }
            
            // Recommandations g√©n√©rales
            if (dimensionScores['Cr√©ation'] < 4) {
                recommendations.push("Tu sembles plus dans la r√©action que dans la cr√©ation. Commence par 15 minutes de cr√©ation par jour.");
            }
            
            return recommendations.slice(0, 5); // Maximum 5 recommandations
        }
        
        // Obtenir la comparaison avec l'√©valuation pr√©c√©dente
        function getEvolutionComparison() {
            if (appData.assessments.length < 2) {
                return '<div class="alert alert-info">Continue √† t\'√©valuer r√©guli√®rement pour voir ton √©volution dans le temps.</div>';
            }
            
            const current = appData.assessments[appData.assessments.length - 1];
            const previous = appData.assessments[appData.assessments.length - 2];
            
            const diff = current.totalScore - previous.totalScore;
            const diffText = diff > 0 ? `+${diff}` : diff;
            const diffColor = diff > 0 ? '#28a745' : (diff < 0 ? '#dc3545' : '#6c757d');
            const emoji = diff > 0 ? 'üìà' : (diff < 0 ? 'üìâ' : '‚û°Ô∏è');
            
            const previousDate = new Date(previous.date).toLocaleDateString('fr-FR');
            
            let html = `
                <div class="alert alert-info">
                    <strong>${emoji} √âvolution depuis le ${previousDate}</strong><br>
                    Score pr√©c√©dent : ${previous.totalScore}/40<br>
                    Score actuel : ${current.totalScore}/40<br>
                    √âvolution : <span style="color: ${diffColor}; font-weight: bold;">${diffText} points</span>
                </div>
            `;
            
            // Comparaison par dimension
            html += '<div style="margin-top: 15px;"><strong>√âvolution par dimension :</strong></div>';
            html += '<div class="dimension-scores">';
            
            for (const dimension in current.dimensionScores) {
                const currentScore = current.dimensionScores[dimension];
                const previousScore = previous.dimensionScores[dimension];
                const dimDiff = currentScore - previousScore;
                const dimDiffText = dimDiff > 0 ? `+${dimDiff}` : dimDiff;
                const dimDiffColor = dimDiff > 0 ? '#28a745' : (dimDiff < 0 ? '#dc3545' : '#6c757d');
                
                html += `
                    <div class="dimension-score">
                        <h4>${dimension}</h4>
                        <div class="dimension-score-value">${currentScore}/8 <span style="font-size: 0.8em; color: ${dimDiffColor};">(${dimDiffText})</span></div>
                        <div class="score-bar">
                            <div class="score-fill" style="width: ${(currentScore / 8) * 100}%"></div>
                        </div>
                    </div>
                `;
            }
            
            html += '</div>';
            
            return html;
        }
        
        // Afficher l'historique
        function displayHistory() {
            const historyContent = document.getElementById('historyContent');
            
            if (appData.assessments.length === 0) {
                historyContent.innerHTML = `
                    <div class="history-empty">
                        <h3>üìä Aucune √©valuation pour le moment</h3>
                        <p style="margin-top: 15px;">Commence ta premi√®re √©valuation pour suivre ton √©volution.</p>
                        <button class="btn" onclick="switchTab('assessment'); document.querySelector('.nav-tab:nth-child(2)').click();">Faire une √©valuation</button>
                    </div>
                `;
                return;
            }
            
            // Trier les √©valuations par date (plus r√©cente en premier)
            const sortedAssessments = [...appData.assessments].sort((a, b) => 
                new Date(b.date) - new Date(a.date)
            );
            
            // Cr√©er le graphique d'√©volution
            let html = '<div class="chart-container">';
            html += '<div class="chart-title">üìà √âvolution de ton score Amor Fati</div>';
            html += createChart(sortedAssessments.reverse());
            html += '</div>';
            
            // Afficher la liste des √©valuations
            html += '<div class="history-list">';
            
            sortedAssessments.reverse().forEach((assessment, index) => {
                const date = new Date(assessment.date);
                const dateStr = date.toLocaleDateString('fr-FR', { 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                });
                const timeStr = date.toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' });
                
                const priorityLabels = {
                    'ressentiment': 'üî• Pass√© & Ressentiment',
                    'souffrance': '‚ö° Souffrance pr√©sente',
                    'authenticite': 'üé≠ Authenticit√©',
                    'creation': 'üé® Cr√©ation',
                    'eternel': '‚ôæÔ∏è √âternel Retour',
                    'none': 'üß≠ Aucune priorit√©'
                };
                
                html += `
                    <div class="history-item" onclick="viewAssessmentDetails(${appData.assessments.length - 1 - index})">
                        <div class="history-header">
                            <div class="history-date">${dateStr} √† ${timeStr}</div>
                            <div class="history-score">${assessment.totalScore}/40</div>
                        </div>
                        ${assessment.context ? `<div class="history-context">"${assessment.context}"</div>` : ''}
                        <div class="history-priority">Priorit√© : ${priorityLabels[assessment.priority] || 'Non d√©finie'}</div>
                    </div>
                `;
            });
            
            html += '</div>';
            
            historyContent.innerHTML = html;
        }
        
        // Cr√©er un graphique simple en SVG
        function createChart(assessments) {
            if (assessments.length < 2) {
                return '<p style="text-align: center; color: #666;">Effectue au moins 2 √©valuations pour voir ton √©volution.</p>';
            }
            
            const width = 100; // pourcentage
            const height = 200;
            const padding = 30;
            const maxScore = 40;
            
            // Calculer les points
            const points = assessments.map((a, i) => {
                const x = padding + (i / (assessments.length - 1)) * (100 - 2 * padding);
                const y = height - padding - ((a.totalScore / maxScore) * (height - 2 * padding));
                return { x, y, score: a.totalScore, date: new Date(a.date) };
            });
            
            // Cr√©er le chemin SVG
            let pathD = `M ${points[0].x} ${points[0].y}`;
            for (let i = 1; i < points.length; i++) {
                pathD += ` L ${points[i].x} ${points[i].y}`;
            }
            
            // Cr√©er le SVG
            let svg = `
                <svg viewBox="0 0 100 ${height}" style="width: 100%; height: ${height}px; background: #f8f9fa; border-radius: 8px;">
                    <!-- Grille -->
                    <line x1="${padding}" y1="${padding}" x2="${padding}" y2="${height - padding}" stroke="#ddd" stroke-width="0.5"/>
                    <line x1="${padding}" y1="${height - padding}" x2="${100 - padding}" y2="${height - padding}" stroke="#ddd" stroke-width="0.5"/>
                    
                    <!-- Lignes de r√©f√©rence -->
                    ${[0, 10, 20, 30, 40].map(score => {
                        const y = height - padding - ((score / maxScore) * (height - 2 * padding));
                        return `
                            <line x1="${padding}" y1="${y}" x2="${100 - padding}" y2="${y}" stroke="#e0e0e0" stroke-width="0.3" stroke-dasharray="2,2"/>
                            <text x="${padding - 3}" y="${y + 1}" font-size="3" fill="#666" text-anchor="end">${score}</text>
                        `;
                    }).join('')}
                    
                    <!-- Ligne d'√©volution -->
                    <path d="${pathD}" fill="none" stroke="url(#gradient)" stroke-width="1" stroke-linecap="round"/>
                    
                    <!-- Points -->
                    ${points.map((p, i) => `
                        <circle cx="${p.x}" cy="${p.y}" r="1.5" fill="#667eea"/>
                        <title>${p.date.toLocaleDateString('fr-FR')} : ${p.score}/40</title>
                    `).join('')}
                    
                    <!-- Gradient -->
                    <defs>
                        <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="0%">
                            <stop offset="0%" style="stop-color:#667eea;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#764ba2;stop-opacity:1" />
                        </linearGradient>
                    </defs>
                </svg>
            `;
            
            return svg;
        }
        
        // Voir les d√©tails d'une √©valuation
        function viewAssessmentDetails(index) {
            const assessment = appData.assessments[index];
            displayResults(assessment);
            switchTab('assessment');
            document.querySelector('.nav-tab:nth-child(2)').click();
        }
        
        // Afficher les param√®tres
        function displaySettings() {
            const priorityLabels = {
                'ressentiment': 'üî• Pass√© & Ressentiment - Me lib√©rer du poids de mon pass√©',
                'souffrance': '‚ö° Souffrance pr√©sente - Mieux accepter les difficult√©s actuelles',
                'authenticite': 'üé≠ Authenticit√© - Vivre selon mes propres valeurs',
                'creation': 'üé® Cr√©ation - Devenir un cr√©ateur actif de ma vie',
                'eternel': '‚ôæÔ∏è √âternel Retour - Affirmer totalement ma vie',
                'none': 'üß≠ Aucune priorit√© sp√©cifique - Observer mon √©volution globale'
            };
            
            document.getElementById('currentPriority').textContent = 
                priorityLabels[appData.priority] || 'Non d√©finie';
        }
        
        // Changer la priorit√©
        function changePriority() {
            const newPriority = prompt(
                "Quelle dimension veux-tu prioriser ?\n\n" +
                "1 - Pass√© & Ressentiment\n" +
                "2 - Souffrance pr√©sente\n" +
                "3 - Authenticit√©\n" +
                "4 - Cr√©ation\n" +
                "5 - √âternel Retour\n" +
                "6 - Aucune priorit√©\n\n" +
                "Entre le num√©ro (1-6) :"
            );
            
            const priorities = ['ressentiment', 'souffrance', 'authenticite', 'creation', 'eternel', 'none'];
            const index = parseInt(newPriority) - 1;
            
            if (index >= 0 && index < priorities.length) {
                appData.priority = priorities[index];
                saveData();
                displaySettings();
                alert('‚úÖ Ta priorit√© a √©t√© mise √† jour !');
            }
        }
        
        // R√©initialiser le formulaire
        function resetForm() {
            document.getElementById('assessmentForm').reset();
            document.querySelectorAll('.option').forEach(opt => opt.classList.remove('selected'));
            document.getElementById('contextNote').value = '';
            document.getElementById('results').classList.remove('show');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        // Exporter les donn√©es
        function exportData() {
            const dataStr = JSON.stringify(appData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `amor-fati-export-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            URL.revokeObjectURL(url);
        }
        
        // Importer les donn√©es
        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    // Valider les donn√©es
                    if (!importedData.assessments || !Array.isArray(importedData.assessments)) {
                        throw new Error('Format de fichier invalide');
                    }
                    
                    // Confirmer l'import
                    if (confirm(`Voulez-vous importer ${importedData.assessments.length} √©valuation(s) ?\n\nCela remplacera vos donn√©es actuelles.`)) {
                        appData = importedData;
                        saveData();
                        alert('‚úÖ Donn√©es import√©es avec succ√®s !');
                        displayHistory();
                        switchTab('history');
                        document.querySelector('.nav-tab:nth-child(3)').click();
                    }
                } catch (error) {
                    alert('‚ùå Erreur lors de l\'import : ' + error.message);
                }
            };
            reader.readAsText(file);
            
            // R√©initialiser l'input
            event.target.value = '';
        }
        
        // Supprimer toutes les donn√©es
        function deleteAllData() {
            if (confirm('‚ö†Ô∏è Es-tu s√ªr(e) de vouloir supprimer TOUTES tes donn√©es ?\n\nCette action est irr√©versible !')) {
                if (confirm('Derni√®re confirmation : toutes tes √©valuations seront perdues d√©finitivement.')) {
                    appData = {
                        priority: null,
                        assessments: [],
                        settings: { lastAssessment: null }
                    };
                    saveData();
                    alert('‚úÖ Toutes les donn√©es ont √©t√© supprim√©es.');
                    switchTab('welcome');
                    document.querySelector('.nav-tab:first-child').click();
                }
            }
        }
        
        // Sauvegarder les donn√©es dans localStorage
        function saveData() {
            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(appData));
            } catch (e) {
                console.error('Erreur de sauvegarde:', e);
                alert('‚ö†Ô∏è Erreur lors de la sauvegarde des donn√©es.');
            }
        }
        
        // Charger les donn√©es depuis localStorage
        function loadData() {
            try {
                const stored = localStorage.getItem(STORAGE_KEY);
                if (stored) {
                    appData = JSON.parse(stored);
                    
                    // Si l'utilisateur a d√©j√† des donn√©es, aller directement √† l'onglet √©valuation
                    if (appData.priority && appData.assessments.length > 0) {
                        // Ne rien faire, laisser l'onglet accueil par d√©faut
                    }
                }
            } catch (e) {
                console.error('Erreur de chargement:', e);
            }
        }
        
        // Enregistrer le Service Worker pour PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then(reg => {
                        console.log('Service Worker registered.', reg);
                        // Listen for updates to the service worker
                        if (reg.waiting) {
                            notifyUpdateReady(reg);
                        }

                        reg.addEventListener('updatefound', () => {
                            const newWorker = reg.installing;
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed') {
                                    if (navigator.serviceWorker.controller) {
                                        // New update available
                                        notifyUpdateReady(reg);
                                    }
                                }
                            });
                        });
                    })
                    .catch(err => {
                        console.error('Service Worker registration failed:', err);
                    });
            });
        }

        // Show update UI and wire actions
        function notifyUpdateReady(reg) {
            const banner = document.getElementById('updateBanner');
            const reloadBtn = document.getElementById('updateReload');
            const dismissBtn = document.getElementById('updateDismiss');
            banner.style.display = 'block';

            reloadBtn.onclick = () => {
                if (!reg || !reg.waiting) return;
                // Ask SW to skip waiting
                reg.waiting.postMessage({ type: 'SKIP_WAITING' });
            };

            dismissBtn.onclick = () => {
                banner.style.display = 'none';
            };
        }

        // Add-to-home modal logic
        (function() {
            const modal = document.getElementById('addModal');
            const btnAction = document.getElementById('addModalAction');
            const btnDismiss = document.getElementById('addModalDismiss');

            // Show modal on first visit (use localStorage flag)
            const shown = localStorage.getItem('amorFati_addModalShown');
            if (!shown) {
                // Wait a bit to not interrupt initial load
                setTimeout(() => {
                    if (modal) modal.style.display = 'flex';
                }, 1200);
            }

            btnDismiss && btnDismiss.addEventListener('click', () => {
                if (modal) modal.style.display = 'none';
                localStorage.setItem('amorFati_addModalShown', '1');
            });

            btnAction && btnAction.addEventListener('click', async () => {
                // If we have deferredPrompt (Chrome) offer it
                if (window.deferredPrompt) {
                    window.deferredPrompt.prompt();
                    try {
                        await window.deferredPrompt.userChoice;
                    } catch (e) {}
                    window.deferredPrompt = null;
                    if (modal) modal.style.display = 'none';
                    localStorage.setItem('amorFati_addModalShown', '1');
                    return;
                }

                // Otherwise show short instructions for iOS
                alert('Sur iOS : ouvrir le menu Partager puis choisir "Ajouter √† l\'√©cran d\'accueil".');
                if (modal) modal.style.display = 'none';
                localStorage.setItem('amorFati_addModalShown', '1');
            });
        })();

        // When the new service worker takes control, reload the page to apply the update
        navigator.serviceWorker && navigator.serviceWorker.addEventListener && navigator.serviceWorker.addEventListener('controllerchange', function() {
            window.location.reload();
        });
    </script>
</body>
</html>