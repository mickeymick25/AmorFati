<!DOCTYPE html>
<html lang="fr">
<head>
    <!-- Commit: fichier mis à jour et poussé le 2025-11-09 -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="theme-color" content="#667eea">
    <!-- iOS / Safari PWA meta -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="AmorFati">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="icons/icon-192.png" sizes="192x192">
    <link rel="shortcut icon" href="icons/icon-192.png">
    <link rel="stylesheet" href="styles.css">
    <title>Amor Fati Tracker</title>
</head>
<body>
    <header class="app-header">
        <h1>Amor Fati</h1>
        <nav class="nav-tabs">
            <button class="nav-tab active" data-tab="welcome">Accueil</button>
            <button class="nav-tab" data-tab="assessment">Évaluer</button>
            <button class="nav-tab" data-tab="history">Historique</button>
            <button class="nav-tab" data-tab="settings">Paramètres</button>
        </nav>
    </header>

    <main>
        <section id="welcome" class="tab active">
            <h2>Bienvenue</h2>
            <p>Suivez votre évolution avec Amor Fati.</p>
        </section>

        <section id="assessment" class="tab">
            <h2>Nouvelle évaluation</h2>
            <form id="assessmentForm">
                <div class="field">
                    <label>Ressentiment (0-8)</label>
                    <input type="number" name="ressentiment" min="0" max="8" value="0">
                </div>
                <div class="field">
                    <label>Souffrance présente (0-8)</label>
                    <input type="number" name="souffrance" min="0" max="8" value="0">
                </div>
                <div class="field">
                    <label>Authenticité (0-8)</label>
                    <input type="number" name="authenticite" min="0" max="8" value="0">
                </div>
                <div class="field">
                    <label>Création (0-8)</label>
                    <input type="number" name="creation" min="0" max="8" value="0">
                </div>
                <div class="field">
                    <label>Éternel Retour (0-8)</label>
                    <input type="number" name="eternel" min="0" max="8" value="0">
                </div>

                <div class="field">
                    <label>Priorité</label>
                    <select name="priority">
                        <option value="none">Aucune</option>
                        <option value="ressentiment">Passé & Ressentiment</option>
                        <option value="souffrance">Souffrance présente</option>
                        <option value="authenticite">Authenticité</option>
                        <option value="creation">Création</option>
                        <option value="eternel">Éternel Retour</option>
                    </select>
                </div>

                <div class="field">
                    <label>Contexte (optionnel)</label>
                    <textarea id="contextNote" name="context" rows="3"></textarea>
                </div>

                <div class="actions">
                    <button type="submit" class="btn">Enregistrer</button>
                    <button type="button" id="resetForm" class="btn">Réinitialiser</button>
                </div>
            </form>

            <div id="results" class="results"></div>
        </section>

        <section id="history" class="tab">
            <h2>Historique</h2>
            <div id="historyContent"></div>
            <div class="history-actions">
                <button class="btn" onclick="exportData()">Exporter</button>
                <input id="importInput" type="file" accept="application/json" />
                <button class="btn" onclick="deleteAllData()">Supprimer tout</button>
            </div>
        </section>

        <section id="settings" class="tab">
            <h2>Paramètres</h2>
            <div>Priorité courante : <span id="currentPriority">Non définie</span></div>
            <div style="margin-top:10px">
                <button class="btn" onclick="changePriority()">Changer la priorité</button>
            </div>
        </section>
    </main>

    <!-- Update banner shown when service worker update available -->
    <div id="updateBanner" style="display:none; position:fixed; bottom:16px; left:16px; right:16px; background:#fff; border:1px solid #ddd; padding:10px; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,0.08); z-index:1000;">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <div>Nouvelle version disponible.</div>
            <div>
                <button id="updateReload" class="btn">Recharger</button>
                <button id="updateDismiss" class="btn">Ignorer</button>
            </div>
        </div>
    </div>

    <!-- Add-to-home modal for iOS fallback -->
    <div id="addModal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.4); align-items:center; justify-content:center; z-index:1001;">
        <div style="background:#fff; padding:16px; border-radius:8px; max-width:420px; width:90%;">
            <h3>Ajouter à l'écran d'accueil</h3>
            <p>Pour installer l'app, utilisez l'option "Ajouter à l'écran d'accueil" dans votre navigateur.</p>
            <div style="display:flex; gap:8px; justify-content:flex-end; margin-top:12px;">
                <button id="addModalDismiss" class="btn">Fermer</button>
                <button id="addModalAction" class="btn">Comment faire</button>
            </div>
        </div>
    </div>

    <script src="app.js" defer></script>
</body>
</html>