<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Hors ligne ‚Äî Amor Fati Tracker</title>
  <style>
    body { font-family: system-ui, -apple-system, 'Segoe UI', Roboto, Arial; margin:0; background: #f8f9fa; color:#222; display:flex; align-items:center; justify-content:center; height:100vh; }
    .card { background:white; padding:24px; border-radius:12px; box-shadow:0 8px 30px rgba(0,0,0,0.12); max-width:520px; text-align:center }
    h1 { color:#667eea; margin-bottom:8px }
    p { color:#555 }
    a.button { display:inline-block; margin-top:16px; padding:10px 16px; background:#667eea; color:#fff; border-radius:8px; text-decoration:none }
  </style>
</head>
<body>
  <div class="card">
    <h1>üîå Hors ligne</h1>
    <p>Tu es hors connexion. Tu peux consulter tes derni√®res √©valuations sauvegard√©es localement ci-dessous.</p>

    <div id="historyContainer" style="margin-top:14px; text-align:left"></div>

    <p style="margin-top:12px;">Lorsque tu seras de nouveau en ligne, recharge la page pour synchroniser et obtenir la derni√®re version.</p>
    <a class="button" href="/">Revenir √† l'application</a>
  </div>
  <script>
    // Affiche l'historique depuis localStorage (cl√©: amorFatiData)
    function renderHistory() {
      const container = document.getElementById('historyContainer');
      container.innerHTML = '';
      try {
        const raw = localStorage.getItem('amorFatiData');
        if (!raw) {
          container.innerHTML = '<p style="color:#666">Aucune √©valuation sauvegard√©e localement.</p>';
          return;
        }
        const data = JSON.parse(raw);
        if (!data.assessments || data.assessments.length === 0) {
          container.innerHTML = '<p style="color:#666">Aucune √©valuation sauvegard√©e localement.</p>';
          return;
        }

        const list = document.createElement('div');
        list.style.display = 'flex';
        list.style.flexDirection = 'column';
        list.style.gap = '10px';

        // Montrer les √©valuations les plus r√©centes en premier
        const sorted = data.assessments.slice().sort((a,b) => new Date(b.date) - new Date(a.date));
        sorted.forEach(ass => {
          const item = document.createElement('div');
          item.style.background = '#fff';
          item.style.padding = '10px';
          item.style.borderRadius = '8px';
          item.style.boxShadow = '0 4px 12px rgba(0,0,0,0.06)';

          const d = new Date(ass.date);
          const title = document.createElement('div');
          title.style.fontWeight = '700';
          title.style.color = '#333';
          title.textContent = d.toLocaleString('fr-FR') + ' ‚Äî ' + (ass.totalScore || 'N/A') + '/40';

          const ctx = document.createElement('div');
          ctx.style.color = '#666';
          ctx.style.fontStyle = 'italic';
          ctx.style.marginTop = '6px';
          ctx.textContent = ass.context ? '"' + ass.context + '"' : '';

          item.appendChild(title);
          if (ass.priority) {
            const p = document.createElement('div');
            p.style.fontSize = '13px';
            p.style.color = '#555';
            p.style.marginTop = '6px';
            p.textContent = 'Priorit√© : ' + (ass.priority || '‚Äî');
            item.appendChild(p);
          }
          item.appendChild(ctx);
          list.appendChild(item);
        });

        container.appendChild(list);
      } catch (e) {
        container.innerHTML = '<p style="color:#c00">Erreur lors de la lecture des donn√©es locales.</p>';
        console.error(e);
      }
    }

    renderHistory();
  </script>
</body>
</html>
